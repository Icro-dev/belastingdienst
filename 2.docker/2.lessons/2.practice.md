## Containers 102

Now it is time to take the second half of the course about containers. Your team also wants to learn how to manage networking and storage in containers.

In this second half is about these two topics:

- **Connect two containers.** In many cases, containers need to interact with each other.
- **Manage volumes.** Containers can be able to persist data, that can be done with volumes.

### Manage networking

With the following commands you will be able to create a new network and connect multiple containers.

```bash
# Create a new network
docker network create -d bridge mynet

# List the networks
 docker network list

# Create a new mysql container connected to the network
docker run --name some-mysql --net mynet -e MYSQL_ROOT_PASSWORD=mysecret -d mysql:8

# Create a new ubuntu container to interact with the mysql server
docker run --rm -it --net mynet ubuntu bash

# Update the packages
apt update

# Install the mysql client command
apt install -qqy default-mysql-client

# Connect to the mysql server from the ubuntu container
# Take into consideration that some-mysql is the name of the container
mysql -u root -p -h some-mysql

# Install dnstools
apt install -qqy dnsutils

# Find the IP address of the mysql container
dig +short some-mysql
exit

# Remove the mysql container
docker rm --force some-mysql

# Remove the network
docker network rm mynet
```

### Manage volumes

What happened with the information generated by the containers? It is gone, unless you attach a volume.

```bash
# Create a new volume
docker volume create myvolume

# Create a new ubuntu container that makes use of myvolume
docker run -it --name ubuntu-container -v myvolume:/root/myvolume/ ubuntu /bin/bash

# Access to the directory in the container
cd /root/myvolume/

# Create a new file
touch newfile

# Add content to the file
echo writing something to the file > newfile 
cat newfile 

exit

docker rm ubuntu-container

# make sure that the container is not there anymore
docker ps

# recreate the container to remount the volume
docker run -it --name ubuntu-container -v myvolume:/root/myvolume/ ubuntu /bin/bash

# check if the file still exists
ls /root/myvolume/

# check the content of the file
cat /root/myvolume/newfile

# Let's now test this with a mysql server
docker volume create dbvolume

# create the mysql server with the attached container
docker run --name some-mysql -v dbvolume:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=mysecret -d mysql:8

# Inject a bash process to the previously created container
docker exec -it some-mysql bash

# Access to the database
mysql -u root -pmysecret

# Create and use a new database
CREATE DATABASE inventory;
USE inventory;

# Create a new table
CREATE TABLE Person (
  name VARCHAR(255),
  country VARCHAR(255),
  age INT
);

# Insert some records
INSERT INTO Person (name, country, age)
VALUES
    ('John', 'Netherlands', 42),
    ('Paul', 'Germany', 17),
    ('Mark', 'Italy', 21),
    ('Linda', 'United States', 34);

# exit from mysql
exit

# exit from the container
exit

# Remove the container
docker rm --force some-mysql

# check that the conatiner does not exist anymore
docker ps

# Create again the same container using the same volume
docker run --name some-mysql -v dbvolume:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=mysecret -d mysql:8

# Inject again a bash process
docker exec -it some-mysql bash

# Access to the database
mysql -u root -pmysecret

# List the databases
SHOW DATABASES;

# Use the database inventory
USE inventory;

# List the tables and recods
SHOW TABLES;
SELECT * FROM Person;

exit
exit

docker rm --force some-mysql
docker volumes rm dbvolume
```


## Create the mysql server with both, volume and network attached

**Objectives:**

1. Create a new network called blog
2. Create a new volume called db_blog
3. Create a new mysql container attached to the blog network and the volume db_blog mounted in /var/lib/mysql

## Translate these options to docker compose

You can check the documentation to define networks and volumes:

Network: https://docs.docker.com/compose/compose-file/06-networks/
Volumes: https://docs.docker.com/compose/compose-file/07-volumes/

**Objectives:**

1. Create a new docker compose file in `~/docker/stateful/`.
3. Define a new network in the compose file
4. Define a new volume in the compose file
5. Define a mysql container as service and attach the volume and network

## Enhance your docker compose file with wordpress

Add a new container to the previously created docker compose file

**Objectives:**

1. Add the wordpress container as service to the docker compose file
2. Map the port 80 of the container to the port 8080 of the host. The container also needs to use the network to be able to connect to the mysql server
